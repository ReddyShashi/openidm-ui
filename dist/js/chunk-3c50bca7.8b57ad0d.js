/*!
 * Copyright 2019 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c50bca7"],{"2a07":function(e,t,a){},cbf6:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-container",[a("div",{staticClass:"card mt-4"},[a("div",{staticClass:"card-header py-2"},[a("b-row",[a("b-col",{staticClass:"my-1",attrs:{md:"7"}},[e.createProperties.length>0?a("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.createResourceModal",modifiers:{createResourceModal:!0}}],attrs:{type:"button",variant:"primary"}},[a("i",{staticClass:"fa fa-plus mr-3"}),e._v(e._s(e.$t("common.form.new"))+" "+e._s(this.name))]):e._e()],1),a("b-col",{staticClass:"my-1",attrs:{md:"5"}},[a("div",{staticClass:"d-flex"},[a("b-input-group",[a("b-input-group-prepend",[a("div",{staticClass:"input-group-text inset"},[a("i",{staticClass:"fa fa-search"})])]),a("b-form-input",{staticClass:"inset-left inset-right",attrs:{placeholder:this.$t("pages.access.typeSearch")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("b-input-group-append",[a("b-btn",{staticClass:"inset clear",attrs:{variant:"outline-default",disabled:!e.filter},on:{click:e.clear}},[a("i",{staticClass:"fa fa-times-circle"})])],1)],1)],1)])],1)],1),a("b-table",{staticClass:"mb-0",class:[{"hide-header":e.isLoading}],attrs:{"show-empty":"","table-responsive":"",stacked:"lg",items:e.gridData,fields:e.columns,"per-page":0,hover:e.tableHover,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"no-local-sorting":!0,"sort-direction":e.sortDirection,busy:e.isLoading},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},"row-clicked":e.resourceClicked,"sort-changed":e.sortingChanged},scopedSlots:e._u([{key:"table-busy",fn:function(){return[a("div",{staticClass:"text-center p-5"},[a("b-spinner",{staticClass:"align-middle spinner-large text-primary my-4"}),a("div",[e._v(e._s(e.$t("common.form.loading"))+" "+e._s(e.plural(e.name))+"...")])],1)]},proxy:!0}])}),e.isLoading?e._e():a("div",{staticClass:"card-footer py-2"},[a("nav",{attrs:{"aria-label":"Page navigation example"}},[a("ul",{staticClass:"pagination justify-content-center mb-0"},[a("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-double-left"})])]),a("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(e.currentPage-1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-left"})])]),a("li",{class:[{disabled:e.lastPage},"page-item"],on:{click:function(t){t.preventDefault(),!e.lastPage&&e.paginationChange(e.currentPage+1)}}},[a("a",{staticClass:"page-link",attrs:{href:"#"}},[a("i",{staticClass:"fa fa-angle-right"})])])])])])],1),e.createProperties.length>0?a("fr-create-resource",{attrs:{resourceName:e.name,resourceType:e.resource,createProperties:e.createProperties},on:{refreshGrid:e.clear}}):e._e()],1)},r=[],i=a("2ef0"),o=a.n(i),n=a("761a"),c=a.n(n),l=a("bc3a"),d=a.n(l),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"createModal",attrs:{id:"createResourceModal","cancel-variant":"outline-secondary"},on:{shown:e.focusField},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[a("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.$t("common.form.new"))+" "+e._s(e.resourceName))]),a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[a("i",{staticClass:"fa fa-times"})])]),a("b-row",[a("b-col",[e.createProperties.length>0?a("b-form",{staticClass:"mb-3",attrs:{name:"edit-personal-form"}},[e._l(e.createProperties,(function(t,s){return["string"!==t.type&&"number"!==t.type||void 0!==t.encryption?e._e():a("b-form-group",{key:"createResource"+s},[t.title?a("label",{staticClass:"float-left",attrs:{for:t.title}},[e._v(e._s(t.title))]):a("label",{staticClass:"float-left",attrs:{for:t.key}},[e._v(e._s(t.key))]),"string"===t.type?a("input",{directives:[{name:"validate",rawName:"v-validate",value:t.required?"required":"",expression:"field.required ? 'required' : ''"},{name:"model",rawName:"v-model.trim",value:e.formFields[t.key],expression:"formFields[field.key]",modifiers:{trim:!0}}],ref:0===s?"focusInput":"",refInFor:!0,class:[{"is-invalid":e.errors.has(t.key)},"form-control"],attrs:{"data-vv-validate-on":"submit",name:t.key,type:"text","data-vv-as":t.title,autocomplete:t.key},domProps:{value:e.formFields[t.key]},on:{input:function(a){a.target.composing||e.$set(e.formFields,t.key,a.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}):a("input",{directives:[{name:"validate",rawName:"v-validate",value:t.required?"required":"",expression:"field.required ? 'required' : ''"},{name:"model",rawName:"v-model.number",value:e.formFields[t.key],expression:"formFields[field.key]",modifiers:{number:!0}}],ref:0===s?"focusInput":"",refInFor:!0,class:[{"is-invalid":e.errors.has(t.key)},"form-control"],attrs:{"data-vv-validate-on":"submit",name:t.key,type:"number","data-vv-as":t.title,autocomplete:t.key},domProps:{value:e.formFields[t.key]},on:{input:function(a){a.target.composing||e.$set(e.formFields,t.key,e._n(a.target.value))},blur:function(t){return e.$forceUpdate()}}}),a("fr-validation-error",{attrs:{validatorErrors:e.errors,fieldName:t.key}})],1),"boolean"===t.type?a("b-form-group",{key:"createResource"+s},[a("div",{staticClass:"d-flex flex-column"},[a("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),a("div",{staticClass:"mr-auto"},[a("toggle-button",{staticClass:"mt-2 p-0 fr-toggle-primary",attrs:{height:28,width:56,sync:!0,cssColors:!0,labels:{checked:e.$t("common.form.yes"),unchecked:e.$t("common.form.no")}},model:{value:e.formFields[t.key],callback:function(a){e.$set(e.formFields,t.key,a)},expression:"formFields[field.key]"}})],1)])]):e._e(),"relationship"===t.type?a("fr-relationship-edit",{key:"createResource"+s,attrs:{parentResource:e.resourceType+"/"+e.resourceName,relationshipProperty:t,index:s,setValue:e.setSingletonRelationshipValue,newResource:!0}}):e._e()]})),e.passwordCheck?a("fr-password-policy-input",{attrs:{policyApi:e.resourceType+"/"+e.resourceName+"/policyTest"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}},[a("b-form-group",{staticClass:"mb-3",attrs:{slot:"custom-input"},slot:"custom-input"},[a("label",{attrs:{for:"createPassword"}},[e._v(e._s(e.$t("pages.access.password")))]),a("div",{staticClass:"form-label-password form-label-group mb-0"},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate.initial",value:"required|policy",expression:"'required|policy'",modifiers:{initial:!0}}],attrs:{id:"createPassword",autocomplete:"password",type:e.passwordInputType,name:"password"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}}),a("div",{staticClass:"input-group-append"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.revealNew}},[a("i",{class:[{"fa-eye-slash":!e.showPassword},{"fa-eye":e.showPassword},"fa"]})])])],1)])],1):e._e()],2):[a("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.access.noFields")))])]],2)],1),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"primary",disabled:0===e.formFields.length},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.save")))])],1)])],1)},p=[],f=a("f8f2"),m=a("f13c"),h=a("eea2"),y=a("9588"),g={name:"Create-Resource",components:{"fr-validation-error":y["a"],"fr-password-policy-input":f["a"],"fr-relationship-edit":m["a"]},mixins:[h["a"]],props:{createProperties:{type:Array,required:!0,default:function(){return[]}},resourceName:{type:String,required:!0},resourceType:{type:String,required:!0}},$_veeValidate:{validator:"new"},data:function(){var e={},t=!1;return o.a.each(this.createProperties,(function(a){"string"===a.type||"number"===a.type?e[a.key]="":"relationship"===a.type?e[a.key]={}:e[a.key]=!1,"password"===a.key&&(t=!0)})),{formFields:e,passwordCheck:t,passwordInputType:"password",showPassword:!0}},methods:{saveForm:function(){var e=this,t=this.getRequestService();this.$validator.validateAll().then((function(a){if(a){var s=e.cleanData(o.a.clone(e.formFields));t.post("".concat(e.resourceType,"/").concat(e.resourceName,"?_action=create"),s).then((function(){e.$emit("refreshGrid"),e.errors.clear(),e.hideModal(),e.displayNotification("success",e.$t("pages.access.successCreate",{resource:o.a.capitalize(e.resourceName)}))}),(function(t){var a=e.findPolicyError(t.response,e.createProperties);e.errors.clear(),a.length>0?o.a.each(a,(function(t){t.exists&&e.errors.add(t)})):e.displayNotification("error",e.$t("pages.access.invalidCreate"))}))}else e.displayNotification("error",e.$t("pages.access.invalidCreate"))}))},hideModal:function(){this.resetDialog(),this.$refs.createModal.hide()},resetDialog:function(){var e=this;this.errors.clear(),this.passwordInputType="password",this.showPassword=!0,o.a.each(this.formFields,(function(t,a){o.a.isString(t)||o.a.isNumber(t)?e.formFields[a]="":e.formFields[a]=!1}))},revealNew:function(){"password"===this.passwordInputType?(this.passwordInputType="text",this.showPassword=!1):(this.passwordInputType="password",this.showPassword=!0)},cleanData:function(e){return o.a.each(e,(function(t,a){o.a.isString(t)&&0===t.length&&delete e[a]})),e},focusField:function(){o.a.isArray(this.$refs.focusInput)&&this.$refs.focusInput[0].focus()},getRelationshipDisplayFields:function(e,t){return o.a.find(e.resourceCollection,{path:t._refResourceCollection}).query.fields},setSingletonRelationshipValue:function(e,t){this.formFields[e]=t}}},v=g,b=a("2877"),w=Object(b["a"])(v,u,p,!1,null,null,null),k=w.exports,C={name:"Access",components:{"fr-create-resource":k},data:function(){return{name:this.$route.params.resourceName,resource:this.$route.params.resourceType,schemaProperties:{},isRowSelected:!1,tableHover:!0,gridData:[],columns:[],displayFields:[],currentPage:1,lastPage:!1,sortBy:null,sortDesc:!1,sortDirection:"asc",filter:"",createProperties:[],userCanUpdate:!1,isLoading:!0}},mounted:function(){this.loadData()},methods:{loadData:function(){var e=this,t=this.getRequestService();d.a.all([t.get("schema/".concat(this.resource,"/").concat(this.name)),t.get("privilege/".concat(this.resource,"/").concat(this.name))]).then(d.a.spread((function(t,a){a.data.VIEW.allowed&&o.a.each(a.data.VIEW.properties,(function(a){var s=t.data.properties[a];e.columns.length<=3&&o.a.isUndefined(s.encryption)&&o.a.includes(["string","boolean","number"],s.type)&&(e.columns.push({key:a,label:s.title,sortable:!0,sortDirection:"desc"}),e.displayFields.push(a))})),a.data.UPDATE&&(e.userCanUpdate=!0),e.schemaProperties=t.data.properties,a.data.CREATE.allowed&&o.a.each(a.data.CREATE.properties,(function(a){var s=t.data.properties[a].type;"string"!==s&&"number"!==s&&"boolean"!==s&&"relationship"!==s||(t.data.properties[a].key=a,o.a.each(t.data.required,(function(e){e===t.data.properties[a].key&&(t.data.properties[a].required=!0)})),e.createProperties.push(t.data.properties[a]))})),e.loadGrid("true",e.displayFields,e.displayFields[0],1)}))).catch((function(t){e.displayNotification("error",t.response.data.message)}))},loadGrid:function(e,t,a,s){var r=this,i=this.getRequestService();this.isLoading=!0,i.get(this.buildGridUrl(e,t,a,s)).then((function(e){e.data.pagedResultsCookie?r.lastPage=!1:r.lastPage=!0,r.gridData=e.data.result,r.isLoading=!1})).catch((function(e){r.isLoading=!1,r.displayNotification("error",e.response.data.message)}))},buildGridUrl:function(e,t,a,s){var r="".concat(this.resource,"/").concat(this.name,"?_queryFilter=").concat(e,"&_pageSize=10");if(o.a.isNull(a)&&(a=t[0]),r="".concat(r,"&_sortKeys=").concat(a),t.length&&(r="".concat(r,"&_fields=").concat(t.join(","))),s>1){var i=10*(s-1);r="".concat(r,"&_pagedResultsOffset=").concat(i)}return r},calculateSort:function(e,t){var a=null;return o.a.isNull(t)||(a=e?"".concat(t):"-".concat(t)),a},sortingChanged:function(e){this.currentPage=1,this.lastPage=!1,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(e.sortDesc,e.sortBy),1)},paginationChange:function(e){this.currentPage=e,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(this.sortDesc,this.sortBy),e)},search:function(){this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.lastPage=!1,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,null,1)},generateSearch:function(e,t,a){var s="";return e.length>0?(e=encodeURIComponent(e),o.a.each(t,(function(r,i){var n="string";o.a.isUndefined(a)||(n=a[r].type),s=("number"!==n||o.a.isNaN(o.a.toNumber(e)))&&("boolean"!==n||"true"!==e&&"false"!==e)?i+1<t.length?"".concat(s).concat(r,'+sw+"').concat(e,'"+OR+'):"".concat(s).concat(r,'+sw+"').concat(e,'"'):i+1<t.length?"".concat(s).concat(r,"+eq+ ").concat(e,"+OR+"):"".concat(s).concat(r,"+eq+ ").concat(e)}))):s="true",s},clear:function(){this.filter="",this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.loadGrid("true",this.displayFields,null,1)},resourceClicked:function(e){this.userCanUpdate?this.$router.push({name:"EditResource",params:{resourceType:this.resource,resourceName:this.name,resourceId:e._id}}):this.displayNotification("error",this.$t("pages.access.unableToEditResource",{resource:this.name}))},plural:function(e){return c()(e)}}},P=C,_=(a("f0cb"),Object(b["a"])(P,s,r,!1,null,"0627a33a",null));t["default"]=_.exports},f0cb:function(e,t,a){"use strict";var s=a("2a07"),r=a.n(s);r.a}}]);
//# sourceMappingURL=chunk-3c50bca7.8b57ad0d.js.map