/*!
 * Copyright 2019 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-314bce90"],{"201b":function(e,t,a){},9588:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:e.validatorErrors.has(e.fieldName),expression:"validatorErrors.has(fieldName)"}],staticClass:"fr-validation-requirements text-left"},[a("span",{staticClass:"text-danger"},[e._v(e._s(e.validatorErrors.first(e.fieldName)))])])},i=[],o={name:"Validation-Error",props:["validatorErrors","fieldName"]},l=o,s=a("2877"),n=Object(s["a"])(l,r,i,!1,null,"ad00d232",null);t["a"]=n.exports},"9e67":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"fsModal",attrs:{id:"userDetailsModal","modal-class":"fr-full-screen","cancel-variant":"outline-secondary"},on:{show:e.setModal},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[a("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.title))]),a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[a("i",{staticClass:"fa fa-times"})])]),a("b-container",[a("b-row",[a("b-col",{attrs:{sm:"8","offset-sm":"2"}},[e.formFields.length>0?a("b-form",{staticClass:"mb-3 fr-edit-personal-form",staticStyle:{"flex-direction":"column"},attrs:{name:"edit-personal-form"}},[e._l(e.formFields,(function(t,r){return["string"===t.type||"number"===t.type?a("b-form-group",{key:r,staticStyle:{"min-width":"200px"}},[a("label",{attrs:{for:t.title}},[e._v(e._s(t.title))]),t.required?e._e():a("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))]),"string"===t.type?a("input",{directives:[{name:"validate",rawName:"v-validate",value:t.required?"required":"",expression:"field.required ? 'required' : ''"},{name:"model",rawName:"v-model.trim",value:e.formFields[r].value,expression:"formFields[index].value",modifiers:{trim:!0}}],class:[{"is-invalid":e.errors.has(t.name)},"form-control"],attrs:{"data-vv-validate-on":"submit",name:t.name,type:t.type,"data-vv-as":t.title},domProps:{value:e.formFields[r].value},on:{input:function(t){t.target.composing||e.$set(e.formFields[r],"value",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}):a("input",{directives:[{name:"validate",rawName:"v-validate",value:t.required?"required":"",expression:"field.required ? 'required' : ''"},{name:"model",rawName:"v-model.number",value:e.formFields[r].value,expression:"formFields[index].value",modifiers:{number:!0}}],class:[{"is-invalid":e.errors.has(t.name)},"form-control"],attrs:{"data-vv-validate-on":"submit",name:t.name,type:t.type,"data-vv-as":t.title},domProps:{value:e.formFields[r].value},on:{input:function(t){t.target.composing||e.$set(e.formFields[r],"value",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),a("fr-validation-error",{attrs:{validatorErrors:e.errors,fieldName:t.name}})],1):e._e(),"boolean"===t.type?a("b-form-group",{key:r},[a("div",{staticClass:"d-flex flex-column"},[a("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),a("div",{staticClass:"mr-auto"},[a("toggle-button",{staticClass:"mt-2 p-0 fr-toggle-primary",attrs:{height:28,width:56,sync:!0,cssColors:!0,labels:{checked:e.$t("common.form.yes"),unchecked:e.$t("common.form.no")},value:e.formFields[r].value},on:{change:function(t){e.formFields[r].value=!e.formFields[r].value}}})],1)])]):e._e()]}))],2):[a("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.profile.editProfile.noFields")))])]],2)],1)],1),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.$root.userStore.state.internalUser},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.saveChanges")))])],1)])],1)},i=[],o=a("2ef0"),l=a.n(o),s=a("9588"),n=a("eea2"),d={name:"Edit-Personal-Info",mixins:[n["a"]],components:{"fr-validation-error":s["a"]},$_veeValidate:{validator:"new"},props:{schema:{type:Object,required:!0},profile:{type:Object,required:!0},autoOpen:{type:Boolean,required:!1,default:!1}},data:function(){return{formFields:[],originalFormFields:[],title:this.$t("pages.profile.editProfile.userDetailsTitle")}},mounted:function(){this.autoOpen&&this.$root.$emit("bv::show::modal","userDetailsModal")},methods:{generateFormFields:function(){var e=this,t=this.schema,a=t.order,r=t.properties,i=t.required,o=l.a.filter(a,(function(e){return r[e].viewable&&r[e].userEditable&&"array"!==r[e].type&&"object"!==r[e].type})),s=l.a.map(o,(function(t){return{name:t,key:t,title:r[t].title,value:e.profile[t]||null,type:r[t].type,required:l.a.includes(i,t)}}));return s},hideModal:function(){this.$refs.fsModal.hide()},setModal:function(){var e=this.generateFormFields();this.formFields=e,this.originalFormFields=l.a.cloneDeep(e)},saveForm:function(){var e=this;this.isValid().then((function(t){if(t){var a=e.getRequestService(),r={};l.a.each(e.formFields,(function(e){null!==e.value&&(r[e.name]=e.value)})),a.post("policy/".concat(e.$root.userStore.state.managedResource,"/").concat(e.$root.userStore.state.userId,"?_action=validateObject"),r).then((function(t){if(0===t.data.failedPolicyRequirements.length)e.$emit("updateProfile",e.generateUpdatePatch(e.originalFormFields,e.formFields)),e.errors.clear(),e.hideModal();else{var a=e.findPolicyError({data:{detail:{failedPolicyRequirements:t.data.failedPolicyRequirements}}},e.formFields);e.errors.clear(),a.length>0?l.a.each(a,(function(t){t.exists&&e.errors.add(t)})):e.displayNotification("error",e.$t("pages.profile.editProfile.failedProfileSave"))}}))}}))},isValid:function(){return this.$validator.validateAll()}}},u=d,c=(a("e03f"),a("2877")),m=Object(c["a"])(u,r,i,!1,null,null,null);t["default"]=m.exports},e03f:function(e,t,a){"use strict";var r=a("201b"),i=a.n(r);i.a},eea2:function(e,t,a){"use strict";var r,i,o=a("2ef0"),l=a.n(o),s={name:"Resource-Mixin",methods:{generateUpdatePatch:function(e,t){var a,r=l.a.cloneDeep(e),i=l.a.cloneDeep(t);return l.a.isArray(i)?a=l.a.filter(i,(function(e,t){return e.value!==r[t].value})):(a=[],l.a.each(i,(function(e,t){r[t]!==i[t]&&a.push({value:i[t],name:t})}))),l.a.map(a,(function(e){return""===e.value||null===e.value?{operation:"remove",field:"/"+e.name}:{operation:"add",field:"/"+e.name,value:e.value}}))},findPolicyError:function(e,t){var a=this,r=[];return l.a.has(e,"data.detail.failedPolicyRequirements")&&l.a.each(e.data.detail.failedPolicyRequirements,(function(e){if(e.policyRequirements.length>0){var i="",o=l.a.find(t,(function(t){return t.key===e.property})),s=e.policyRequirements[0].params||{};o&&(i=o.title?o.title:o.key,s.property=i),r.push({exists:i.length>0,field:e.property,msg:a.$t("common.policyValidationMessages.".concat(e.policyRequirements[0].policyRequirement),s)})}})),r}}},n=s,d=a("2877"),u=Object(d["a"])(n,r,i,!1,null,null,null);t["a"]=u.exports}}]);
//# sourceMappingURL=chunk-314bce90.bace2294.js.map